<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="styles/style.css"/>
  <title>Hello, World!</title>
</head>
<body>
  <h1>
   
  </h1>
</body>
</html>

<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Yiko Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #9C27B0;
            --primary-dark: #7B1FA2;
            --accent: #E040FB;
            --bg-dark: #121212;
            --bg-dark-lighter: #1E1E1E;
            --text-light: #FFFFFF;
            --text-secondary: #B0B0B0;
            --success: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
        }
        
        /* Login/Cadastro Styles */
        #auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--primary-dark) 100%);
        }
        
        .auth-box {
            background-color: var(--bg-dark-lighter);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            animation: fadeIn 0.5s;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(156, 39, 176, 0.2);
        }
        
        .auth-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 0%,
                rgba(156, 39, 176, 0.1) 50%,
                transparent 100%
            );
            animation: rotate 10s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .logo {
            width: 100px;
            height: 100px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.5);
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .input-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 16px;
            outline: none;
            border: 1px solid rgba(156, 39, 176, 0.2);
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(156, 39, 176, 0.2);
        }
        
        .input-group input::placeholder {
            color: var(--text-secondary);
        }
        
        .auth-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }
        
        .auth-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }
        
        .auth-switch {
            text-align: center;
            color: var(--text-secondary);
        }
        
        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Chat App Styles */
        #app-container {
            display: none;
            height: 100vh;
            grid-template-columns: 1fr;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar {
            background-color: var(--bg-dark-lighter);
            position: fixed;
            left: -280px;
            top: 0;
            width: 280px;
            height: 100%;
            transition: left 0.3s ease;
            z-index: 100;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            margin-right: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-pic .material-icons {
            font-size: 24px;
        }
        
        .user-name {
            font-weight: 500;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .verified-badge {
            margin-left: 8px;
            color: var(--primary);
        }
        
        .sidebar-actions {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            padding: 10px 0;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            color: var(--text-light);
        }
        
        .action-btn .material-icons {
            margin-right: 12px;
        }
        
        .upgrade-btn {
            margin: 15px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }
        
        .users-list-header {
            padding: 15px 20px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .users-list {
            padding: 0 10px;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 5px;
        }
        
        .user-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .user-item.active {
            background-color: rgba(156, 39, 176, 0.15);
        }
        
        .user-item .profile-pic {
            width: 35px;
            height: 35px;
        }
        
        .user-item .user-info {
            flex: 1;
            margin-left: 10px;
            overflow: hidden;
        }
        
        .user-item .user-name {
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .user-item .last-message {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .user-status.online {
            background-color: var(--success);
        }
        
        /* Chat Section */
        .chat-section {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--bg-dark-lighter);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .menu-toggle {
            margin-right: 15px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .chat-header .user-profile {
            flex: 1;
        }
        
        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }
        
        .message-incoming {
            align-self: flex-start;
            margin-right: auto;
        }
        
        .message-outgoing {
            align-self: flex-end;
            margin-left: auto;
        }
        
        .message-content {
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
        }
        
        .message-incoming .message-content {
            background-color: var(--bg-dark-lighter);
            border-bottom-left-radius: 5px;
        }
        
        .message-outgoing .message-content {
            background-color: var(--primary);
            border-bottom-right-radius: 5px;
        }
        
        .message-time {
            font-size: 11px;
            margin-top: 5px;
            color: var(--text-secondary);
        }
        
        .message-incoming .message-time {
            text-align: left;
        }
        
        .message-outgoing .message-time {
            text-align: right;
        }
        
        .audio-message {
            display: flex;
            align-items: center;
        }
        
        .audio-control {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .audio-wave {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .audio-wave::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: rgba(255, 255, 255, 0.2);
            transition: width 0.1s linear;
        }
        
        .audio-duration {
            margin-left: 8px;
            font-size: 12px;
        }
        
        .chat-footer {
            padding: 15px;
            background-color: var(--bg-dark-lighter);
            display: flex;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .message-input {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 20px;
            padding: 12px 15px;
            color: var(--text-light);
            outline: none;
            font-size: 14px;
        }
        
        .message-input::placeholder {
            color: var(--text-secondary);
        }
        
        .chat-actions {
            display: flex;
            align-items: center;
        }
        
        .chat-action {
            margin-left: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chat-action:hover {
            color: var(--text-light);
        }
        
        .send-btn {
            margin-left: 10px;
            width: 40px;
            height: 40px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }
        
        /* Audio Recording Animation */
        .recording-animation {
            display: none;
            align-items: center;
            padding: 0 10px;
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .recording-time {
            margin-left: 5px;
            font-size: 14px;
        }
        
        /* No messages placeholder */
        .no-messages {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-align: center;
            padding: 0 20px;
        }
        
        .no-messages .material-icons {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .no-messages h3 {
            margin-bottom: 10px;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--bg-dark-lighter);
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            padding: 25px;
            transform: translateY(-20px);
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(156, 39, 176, 0.2);
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .modal-close {
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            color: var(--text-light);
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn-secondary {
            background-color: transparent;
            color: var(--text-secondary);
            margin-right: 10px;
        }
        
        .modal-btn-secondary:hover {
            color: var(--text-light);
        }
        
        .modal-btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .modal-btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        /* Loading Animation */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .loader.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loader-text {
            margin-top: 15px;
            color: var(--text-light);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--bg-dark-lighter);
            border-left: 4px solid var(--primary);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification-content {
            display: flex;
            align-items: center;
        }
        
        .notification-icon {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .notification-message {
            flex: 1;
            font-size: 14px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Autenticação -->
    <div id="auth-container">
        <div id="login-box" class="auth-box">
            <div class="logo">PRO</div>
            <h2 class="auth-title">Chat Yiko Pro</h2>
            <div class="input-group">
                <input type="email" id="login-email" placeholder="Email" required>
            </div>
            <div class="input-group">
                <input type="password" id="login-password" placeholder="Senha" required>
            </div>
            <button id="login-btn" class="auth-btn">Entrar</button>
            <p class="auth-switch">Não tem uma conta? <a href="#" id="show-register">Registre-se</a></p>
        </div>
        
        <div id="register-box" class="auth-box" style="display: none;">
            <div class="logo">PRO</div>
            <h2 class="auth-title">Registrar Chat Yiko Pro</h2>
            <div class="input-group">
                <input type="text" id="register-name" placeholder="Nome completo" required>
            </div>
            <div class="input-group">
                <input type="email" id="register-email" placeholder="Email" required>
            </div>
            <div class="input-group">
                <input type="password" id="register-password" placeholder="Senha" required>
            </div>
            <button id="register-btn" class="auth-btn">Registrar</button>
            <p class="auth-switch">Já tem uma conta? <a href="#" id="show-login">Entrar</a></p>
        </div>
    </div>
    
    <!-- Aplicativo Chat -->
    <div id="app-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="profile-pic" id="user-profile-pic">
                        <span class="material-icons">person</span>
                    </div>
                    <div>
                        <div class="user-name" id="current-user-name">Nome do Usuário</div>
                    </div>
                </div>
                <span class="material-icons verified-badge" id="verification-badge" style="display: none;">verified</span>
            </div>
            
            <div class="sidebar-actions">
                <div class="action-btn" id="edit-profile-btn">
                    <span class="material-icons">edit</span>
                    <span>Editar Perfil</span>
                </div>
                <div class="action-btn" id="logout-btn">
                    <span class="material-icons">logout</span>
                    <span>Sair</span>
                </div>
            </div>
            
            <div class="upgrade-btn" id="upgrade-btn">
                <span>Obter Verificação Azul (12.000 Kz)</span>
            </div>
            
            <div class="users-list-header">
                Conversas
            </div>
            
            <div class="users-list" id="users-list">
                <!-- Lista de usuários será gerada dinamicamente -->
            </div>
        </div>
        
        <div class="chat-section">
            <div class="chat-header">
                <div class="menu-toggle" id="menu-toggle">
                    <span class="material-icons">menu</span>
                </div>
                <div class="user-profile" id="chat-with-user" style="display: none;">
                    <div class="profile-pic" id="chat-user-pic">
                        <span class="material-icons">person</span>
                    </div>
                    <div>
                        <div class="user-name" id="chat-user-name">Selecione um Usuário</div>
                    </div>
                    <span class="material-icons verified-badge" id="chat-user-verified" style="display: none;">verified</span>
                </div>
            </div>
            
            <div class="chat-body" id="chat-body">
                <div class="no-messages" id="no-messages">
                    <span class="material-icons">chat</span>
                    <h3>Chat Yiko Pro</h3>
                    <p>Selecione um usuário para iniciar uma conversa</p>
                </div>
                
                <!-- Mensagens serão geradas dinamicamente -->
            </div>
            
            <div class="chat-footer" id="chat-footer" style="display: none;">
                <input type="text" class="message-input" id="message-input" placeholder="Digite sua mensagem...">
                <div class="chat-actions">
                    <div class="recording-animation" id="recording-animation">
                        <span class="material-icons">mic</span>
                        <span class="recording-time" id="recording-time">00:00</span>
                    </div>
                    <div class="chat-action" id="audio-btn">
                        <span class="material-icons">mic</span>
                    </div>
                    <div class="send-btn" id="send-btn">
                        <span class="material-icons">send</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Edição de Perfil -->
    <div class="modal-overlay" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Perfil</h3>
                <span class="material-icons modal-close" id="close-profile-modal">close</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="profile-pic" style="width: 80px; height: 80px; margin: 0 auto;">
                        <span class="material-icons" style="font-size: 40px;" id="profile-pic-placeholder">person</span>
                        <img id="profile-pic-preview" style="display: none;">
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="profile-pic-upload" style="color: var(--primary); cursor: pointer;">Alterar foto</label>
                        <input type="file" id="profile-pic-upload" accept="image/*" style="display: none;">
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="profile-name" placeholder="Nome">
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn modal-btn-secondary" id="cancel-profile-edit">Cancelar</div>
                <div class="modal-btn modal-btn-primary" id="save-profile">Salvar</div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Upgrade para Verificação -->
    <div class="modal-overlay" id="upgrade-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Verificação Azul</h3>
                <span class="material-icons modal-close" id="close-upgrade-modal">close</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">Obtenha a verificação azul do Chat Yiko Pro por apenas 12.000 Kz.</p>
                <p style="margin-bottom: 15px;">Benefícios:</p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Selo de verificação exclusivo</li>
                    <li>Mais destaque nas conversas</li>
                    <li>Acesso a recursos premium futuros</li>
                </ul>
                <div class="input-group">
                    <input type="text" id="payment-reference" placeholder="Referência de Pagamento">
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn modal-btn-secondary" id="cancel-upgrade">Cancelar</div>
                <div class="modal-btn modal-btn-primary" id="confirm-upgrade">Confirmar</div>
            </div>
        </div>
    </div>
    
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p class="loader-text" id="loader-text">Carregando...</p>
    </div>
    
    <!-- Notificação -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <span class="material-icons notification-icon">info</span>
            <div class="notification-message" id="notification-message"></div>
        </div>
    </div>
    
    <script>
   // Inicialização do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBO_lkHCi7QIOcE1vbNEtx3gknsDfZHAps",
            authDomain: "banco-de-dadossy.firebaseapp.com",
            projectId: "banco-de-dadossy",
            storageBucket: "banco-de-dadossy.appspot.com",
            messagingSenderId: "1972078944",
            appId: "1:1972078944:web:d5c938bb64f05448f87605",
            measurementId: "G-R5DQCJ1N66"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Elementos DOM
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const loginBox = document.getElementById('login-box');
        const registerBox = document.getElementById('register-box');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const registerName = document.getElementById('register-name');
        const registerEmail = document.getElementById('register-email');
        const registerPassword = document.getElementById('register-password');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const usersList = document.getElementById('users-list');
        const currentUserName = document.getElementById('current-user-name');
        const userProfilePic = document.getElementById('user-profile-pic');
        const chatUserName = document.getElementById('chat-user-name');
        const chatUserPic = document.getElementById('chat-user-pic');
        const chatWithUser = document.getElementById('chat-with-user');
        const chatBody = document.getElementById('chat-body');
        const chatFooter = document.getElementById('chat-footer');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const audioBtn = document.getElementById('audio-btn');
        const recordingAnimation = document.getElementById('recording-animation');
        const recordingTime = document.getElementById('recording-time');
        const noMessages = document.getElementById('no-messages');
        const logoutBtn = document.getElementById('logout-btn');
        const profileModal = document.getElementById('profile-modal');
        const closeProfileModal = document.getElementById('close-profile-modal');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const profilePicUpload = document.getElementById('profile-pic-upload');
        const profilePicPreview = document.getElementById('profile-pic-preview');
        const profilePicPlaceholder = document.getElementById('profile-pic-placeholder');
        const profileName = document.getElementById('profile-name');
        const cancelProfileEdit = document.getElementById('cancel-profile-edit');
        const saveProfile = document.getElementById('save-profile');
        const upgradeBtn = document.getElementById('upgrade-btn');
        const upgradeModal = document.getElementById('upgrade-modal');
        const closeUpgradeModal = document.getElementById('close-upgrade-modal');
        const cancelUpgrade = document.getElementById('cancel-upgrade');
        const confirmUpgrade = document.getElementById('confirm-upgrade');
        const paymentReference = document.getElementById('payment-reference');
        const verificationBadge = document.getElementById('verification-badge');
        const chatUserVerified = document.getElementById('chat-user-verified');
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        // Variáveis globais
        let currentUser = null;
        let currentChatUser = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingInterval = null;
        let recordingSeconds = 0;
        let usersData = {};
        
        // Controle de autenticação
        showRegister.addEventListener('click', () => {
            loginBox.style.display = 'none';
            registerBox.style.display = 'block';
        });
        
        showLogin.addEventListener('click', () => {
            registerBox.style.display = 'none';
            loginBox.style.display = 'block';
        });
        
        // Login de usuário
        loginBtn.addEventListener('click', () => {
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            if (!email || !password) {
                showNotification('Por favor, preencha todos os campos.');
                return;
            }
            
            showLoader('Entrando...');
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    loginEmail.value = '';
                    loginPassword.value = '';
                })
                .catch(error => {
                    console.error('Erro ao fazer login:', error);
                    hideLoader();
                    showNotification('Erro ao fazer login: ' + error.message);
                });
        });
        
        // Registro de usuário
        registerBtn.addEventListener('click', () => {
            const name = registerName.value;
            const email = registerEmail.value;
            const password = registerPassword.value;
            
            if (!name || !email || !password) {
                showNotification('Por favor, preencha todos os campos.');
                return;
            }
            
            showLoader('Criando conta...');
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    return db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        email: email,
                        photoURL: '',
                        verified: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    registerName.value = '';
                    registerEmail.value = '';
                    registerPassword.value = '';
                })
                .catch(error => {
                    console.error('Erro ao registrar:', error);
                    hideLoader();
                    showNotification('Erro ao registrar: ' + error.message);
                });
        });
        
        // Observer de estado de autenticação
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                loadUserData();
            } else {
                currentUser = null;
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });
        
        // Carrega dados do usuário atual e inicia o app
        function loadUserData() {
            showLoader('Carregando dados...');
            
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        currentUserName.textContent = userData.name;
                        
                        if (userData.photoURL) {
                            userProfilePic.innerHTML = `<img src="${userData.photoURL}" alt="Profile">`;
                        } else {
                            userProfilePic.innerHTML = `<span class="material-icons">person</span>`;
                        }
                        
                        if (userData.verified) {
                            verificationBadge.style.display = 'inline';
                        } else {
                            verificationBadge.style.display = 'none';
                        }
                        
                        loadAllUsers();
                        
                        authContainer.style.display = 'none';
                        appContainer.style.display = 'grid';
                        hideLoader();
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar dados do usuário:', error);
                    hideLoader();
                    showNotification('Erro ao carregar dados do usuário.');
                });
        }
        
        // Carrega todos os usuários
        function loadAllUsers() {
            db.collection('users').get()
                .then(snapshot => {
                    usersList.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        if (doc.id !== currentUser.uid) {
                            const userData = doc.data();
                            usersData[doc.id] = userData;
                            
                            const userItem = document.createElement('div');
                            userItem.className = 'user-item';
                            userItem.dataset.userId = doc.id;
                            
                            let profilePicHTML = '';
                            if (userData.photoURL) {
                                profilePicHTML = `<img src="${userData.photoURL}" alt="Profile">`;
                            } else {
                                profilePicHTML = `<span class="material-icons">person</span>`;
                            }
                            
                            let verifiedHTML = '';
                            if (userData.verified) {
                                verifiedHTML = `<span class="material-icons verified-badge" style="font-size: 14px;">verified</span>`;
                            }
                            
                            userItem.innerHTML = `
                                <div class="profile-pic">
                                    ${profilePicHTML}
                                </div>
                                <div class="user-info">
                                    <div style="display: flex; align-items: center;">
                                        <div class="user-name">${userData.name}</div>
                                        ${verifiedHTML}
                                    </div>
                                    <div class="last-message">Clique para conversar</div>
                                </div>
                                <div class="user-status online"></div>
                            `;
                            
                            userItem.addEventListener('click', () => {
                                startChat(doc.id, userData);
                                
                                if (window.innerWidth < 768) {
                                    sidebar.classList.remove('active');
                                }
                            });
                            
                            usersList.appendChild(userItem);
                        }
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar usuários:', error);
                    showNotification('Erro ao carregar lista de usuários.');
                });
        }
        
        // Inicia chat com um usuário
        function startChat(userId, userData) {
            currentChatUser = { id: userId, ...userData };
            
            // Atualiza a interface
            chatUserName.textContent = userData.name;
            
            if (userData.photoURL) {
                chatUserPic.innerHTML = `<img src="${userData.photoURL}" alt="Profile">`;
            } else {
                chatUserPic.innerHTML = `<span class="material-icons">person</span>`;
            }
            
            if (userData.verified) {
                chatUserVerified.style.display = 'inline';
            } else {
                chatUserVerified.style.display = 'none';
            }
            
            chatWithUser.style.display = 'flex';
            chatFooter.style.display = 'flex';
            noMessages.style.display = 'none';
            
            // Carrega mensagens
            loadMessages(userId);
            
            // Marca todos os usuários como inativos
            const userItems = document.querySelectorAll('.user-item');
            userItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Marca o usuário atual como ativo
            const currentUserItem = document.querySelector(`.user-item[data-user-id="${userId}"]`);
            if (currentUserItem) {
                currentUserItem.classList.add('active');
            }
        }
        
        // Carrega mensagens
        function loadMessages(userId) {
            chatBody.innerHTML = '';
            
            const chatId = getChatId(currentUser.uid, userId);
            
            db.collection('chats').doc(chatId).collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot(snapshot => {
                    let changes = snapshot.docChanges();
                    
                    changes.forEach(change => {
                        if (change.type === 'added') {
                            displayMessage(change.doc.data());
                        }
                    });
                    
                    // Rola para o final
                    chatBody.scrollTop = chatBody.scrollHeight;
                });
        }
        
        // Exibe uma mensagem
        function displayMessage(message) {
            const isOutgoing = message.senderId === currentUser.uid;
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            
            let messageContentHTML = '';
            
            if (message.type === 'text') {
                messageContentHTML = `<div class="message-content">${message.content}</div>`;
            } else if (message.type === 'audio') {
                messageContentHTML = `
                    <div class="message-content">
                        <div class="audio-message">
                            <div class="audio-control" data-audio-url="${message.content}">
                                <span class="material-icons">play_arrow</span>
                            </div>
                            <div class="audio-wave"></div>
                            <div class="audio-duration">0:00</div>
                        </div>
                    </div>
                `;
            }
            
            const timestamp = message.timestamp ? message.timestamp.toDate() : new Date();
            const formattedTime = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                ${messageContentHTML}
                <div class="message-time">${formattedTime}</div>
            `;
            
            chatBody.appendChild(messageElement);
            
            // Inicializa controles de áudio se necessário
            if (message.type === 'audio') {
                const audioControl = messageElement.querySelector('.audio-control');
                const audioWave = messageElement.querySelector('.audio-wave');
                const audioDuration = messageElement.querySelector('.audio-duration');
                
                let audio = new Audio(message.content);
                let isPlaying = false;
                
                audio.addEventListener('loadedmetadata', () => {
                    const minutes = Math.floor(audio.duration / 60);
                    const seconds = Math.floor(audio.duration % 60);
                    audioDuration.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                });
                
                audio.addEventListener('timeupdate', () => {
                    const progress = (audio.currentTime / audio.duration) * 100;
                    audioWave.style.setProperty('--progress', `${progress}%`);
                    audioWave.style.background = `linear-gradient(to right, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.3) ${progress}%, rgba(255, 255, 255, 0.1) ${progress}%, rgba(255, 255, 255, 0.1) 100%)`;
                    
                    const minutes = Math.floor(audio.currentTime / 60);
                    const seconds = Math.floor(audio.currentTime % 60);
                    audioDuration.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                });
                
                audio.addEventListener('ended', () => {
                    isPlaying = false;
                    audioControl.querySelector('.material-icons').textContent = 'play_arrow';
                });
                
                audioControl.addEventListener('click', () => {
                    if (isPlaying) {
                        audio.pause();
                        audioControl.querySelector('.material-icons').textContent = 'play_arrow';
                    } else {
                        audio.play();
                        audioControl.querySelector('.material-icons').textContent = 'pause';
                    }
                    isPlaying = !isPlaying;
                });
            }
        }
        
        // Envia uma mensagem de texto
        function sendTextMessage() {
            const message = messageInput.value.trim();
            
            if (!message || !currentChatUser) return;
            
            const chatId = getChatId(currentUser.uid, currentChatUser.id);
            
            db.collection('chats').doc(chatId).collection('messages').add({
                type: 'text',
                content: message,
                senderId: currentUser.uid,
                receiverId: currentChatUser.id,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                messageInput.value = '';
            })
            .catch(error => {
                console.error('Erro ao enviar mensagem:', error);
                showNotification('Erro ao enviar mensagem.');
            });
        }
        
        // Envia uma mensagem de áudio
        function sendAudioMessage(audioBlob) {
            if (!audioBlob || !currentChatUser) return;
            
            showLoader('Enviando áudio...');
            
            const chatId = getChatId(currentUser.uid, currentChatUser.id);
            const audioRef = storage.ref().child(`audios/${chatId}/${Date.now()}.webm`);
            
            audioRef.put(audioBlob)
                .then(snapshot => snapshot.ref.getDownloadURL())
                .then(downloadURL => {
                    return db.collection('chats').doc(chatId).collection('messages').add({
                        type: 'audio',
                        content: downloadURL,
                        senderId: currentUser.uid,
                        receiverId: currentChatUser.id,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    hideLoader();
                })
                .catch(error => {
                    console.error('Erro ao enviar áudio:', error);
                    hideLoader();
                    showNotification('Erro ao enviar áudio.');
                });
        }
        
        // Obtem o ID de um chat entre dois usuários
        function getChatId(uid1, uid2) {
            return uid1 < uid2 ? `${uid1}_${uid2}` : `${uid2}_${uid1}`;
        }
        
        // Inicia a gravação de áudio
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    recordingSeconds = 0;
                    
                    mediaRecorder.addEventListener('dataavailable', event => {
                        audioChunks.push(event.data);
                    });
                    
                    mediaRecorder.addEventListener('stop', () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        sendAudioMessage(audioBlob);
                        
                        // Libera o stream
                        stream.getTracks().forEach(track => track.stop());
                    });
                    
                    mediaRecorder.start();
                    
                    // Mostra animação de gravação
                    recordingAnimation.style.display = 'flex';
                    audioBtn.style.display = 'none';
                    
                    // Inicia contador
                    recordingInterval = setInterval(() => {
                        recordingSeconds++;
                        const minutes = Math.floor(recordingSeconds / 60);
                        const seconds = recordingSeconds % 60;
                        recordingTime.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                    }, 1000);
                })
                .catch(error => {
                    console.error('Erro ao acessar microfone:', error);
                    showNotification('Erro ao acessar microfone. Verifique as permissões.');
                });
        }
        
        // Para a gravação de áudio
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                clearInterval(recordingInterval);
                recordingAnimation.style.display = 'none';
                audioBtn.style.display = 'block';
            }
        }
        
        // Editar perfil
        function openProfileModal() {
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        profileName.value = userData.name;
                        
                        if (userData.photoURL) {
                            profilePicPreview.src = userData.photoURL;
                            profilePicPreview.style.display = 'block';
                            profilePicPlaceholder.style.display = 'none';
                        } else {
                            profilePicPreview.style.display = 'none';
                            profilePicPlaceholder.style.display = 'block';
                        }
                    }
                    
                    profileModal.classList.add('active');
                })
                .catch(error => {
                    console.error('Erro ao carregar dados do perfil:', error);
                    showNotification('Erro ao carregar dados do perfil.');
                });
        }
        
        // Salvar perfil
        function saveProfileChanges() {
            const name = profileName.value.trim();
            
            if (!name) {
                showNotification('Por favor, insira um nome.');
                return;
            }
            
            showLoader('Salvando perfil...');
            
            let photoUploadPromise = Promise.resolve(null);
            
            // Verifica se há uma nova foto para carregar
            if (profilePicUpload.files.length > 0) {
                const file = profilePicUpload.files[0];
                const photoRef = storage.ref().child(`profile_pics/${currentUser.uid}`);
                
                photoUploadPromise = photoRef.put(file)
                    .then(snapshot => snapshot.ref.getDownloadURL());
            }
            
            photoUploadPromise
                .then(photoURL => {
                    const userData = {
                        name: name
                    };
                    
                    if (photoURL) {
                        userData.photoURL = photoURL;
                    }
                    
                    return db.collection('users').doc(currentUser.uid).update(userData);
                })
                .then(() => {
                    hideLoader();
                    profileModal.classList.remove('active');
                    showNotification('Perfil atualizado com sucesso!');
                    loadUserData();
                })
                .catch(error => {
                    console.error('Erro ao salvar perfil:', error);
                    hideLoader();
                    showNotification('Erro ao salvar perfil.');
                });
        }
        
        // Upgrade para conta verificada
        function openUpgradeModal() {
            upgradeModal.classList.add('active');
        }
        
        function processUpgrade() {
            const reference = paymentReference.value.trim();
            
            if (!reference) {
                showNotification('Por favor, insira a referência de pagamento.');
                return;
            }
            
            showLoader('Processando verificação...');
            
            // Simulação de processamento de pagamento
            setTimeout(() => {
                db.collection('users').doc(currentUser.uid).update({
                    verified: true
                })
                .then(() => {
                    hideLoader();
                    upgradeModal.classList.remove('active');
                    showNotification('Verificação azul ativada com sucesso!');
                    loadUserData();
                })
                .catch(error => {
                    console.error('Erro ao processar verificação:', error);
                    hideLoader();
                    showNotification('Erro ao processar verificação.');
                });
            }, 2000);
        }
        
        // Event Listeners
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        
        sendBtn.addEventListener('click', sendTextMessage);
        
        messageInput.addEventListener('keypress', event => {
            if (event.key === 'Enter') {
                sendTextMessage();
            }
        });
        
        let isRecording = false;
        
        audioBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
            isRecording = !isRecording;
        });
        
        recordingAnimation.addEventListener('click', () => {
            stopRecording();
            isRecording = false;
        });
        
        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .catch(error => {
                    console.error('Erro ao fazer logout:', error);
                    showNotification('Erro ao fazer logout.');
                });
        });
        
        editProfileBtn.addEventListener('click', openProfileModal);
        
        closeProfileModal.addEventListener('click', () => {
            profileModal.classList.remove('active');
        });
        
        cancelProfileEdit.addEventListener('click', () => {
            profileModal.classList.remove('active');
        });
        
        saveProfile.addEventListener('click', saveProfileChanges);
        
        profilePicUpload.addEventListener('change', event => {
            const file = event.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = e => {
                    profilePicPreview.src = e.target.result;
                    profilePicPreview.style.display = 'block';
                    profilePicPlaceholder.style.display = 'none';
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        upgradeBtn.addEventListener('click', openUpgradeModal);
        
        closeUpgradeModal.addEventListener('click', () => {
            upgradeModal.classList.remove('active');
        });
        
        cancelUpgrade.addEventListener('click', () => {
            upgradeModal.classList.remove('active');
        });
        
        confirmUpgrade.addEventListener('click', processUpgrade);
        
        // Funções auxiliares
        function showLoader(text) {
            loaderText.textContent = text || 'Carregando...';
            loader.classList.add('active');
        }
        
        function hideLoader() {
            loader.classList.remove('active');
        }
        
        function showNotification(message) {
            notificationMessage.textContent = message;
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        // Previne o redirecionamento para página de login após refresh
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                localStorage.setItem('userLoggedIn', 'true');
            }
        });
        
        // Verifica se o usuário estava logado anteriormente
        if (localStorage.getItem('userLoggedIn') === 'true') {
            showLoader('Restaurando sessão...');
        }
    </script>
</body>
</html>
